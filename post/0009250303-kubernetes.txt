3:I[4707,[],""]
5:I[6423,[],""]
6:I[4829,["679","static/chunks/679-09931d2c20ac23c4.js","185","static/chunks/app/layout-04b5cc4ae96ec103.js"],"default"]
4:["slug","0009250303-kubernetes","d"]
0:["tugn7ZYrCi5paj1z_qOlq",[[["",{"children":["post",{"children":[["slug","0009250303-kubernetes","d"],{"children":["__PAGE__?{\"slug\":\"0009250303-kubernetes\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["post",{"children":[["slug","0009250303-kubernetes","d"],{"children":["__PAGE__",{},[["$L1","$L2",[["$","link","0",{"rel":"stylesheet","href":"/tech-blog/_next/static/css/86708423b213bf15.css","precedence":"next","crossOrigin":"$undefined"}]]],null],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","post","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","post","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/tech-blog/_next/static/css/2902b82ade31b364.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"ko","className":"__className_c5102c","children":[["$","head",null,{"children":[["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"}],["$","meta",null,{"name":"theme-color","content":"#ffffff","media":"(prefers-color-scheme: light)"}],["$","meta",null,{"name":"theme-color","content":"#000000","media":"(prefers-color-scheme: dark)"}],["$","meta",null,{"name":"naver-site-verification","content":"1df124e1d8331da4467178ffddd6188e1d413576"}],["$","meta",null,{"name":"google-adsense-account","content":"ca-pub-6151583773425822"}],["$","link",null,{"rel":"dns-prefetch","href":"https://fonts.googleapis.com"}],["$","link",null,{"rel":"dns-prefetch","href":"https://fonts.gstatic.com"}],["$","link",null,{"rel":"preconnect","href":"https://fonts.googleapis.com","crossOrigin":"anonymous"}],["$","link",null,{"rel":"preconnect","href":"https://fonts.gstatic.com","crossOrigin":"anonymous"}],["$","script",null,{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6151583773425822","crossOrigin":"anonymous"}]]}],["$","$L6",null,{"children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[]}]}]]}]],null],null],["$L7",null]]]]
8:I[2089,["605","static/chunks/app/post/%5Bslug%5D/page-5fc1a46522590ee2.js"],"default"]
9:I[3299,["605","static/chunks/app/post/%5Bslug%5D/page-5fc1a46522590ee2.js"],"default"]
a:I[1040,["605","static/chunks/app/post/%5Bslug%5D/page-5fc1a46522590ee2.js"],"default"]
c:I[2786,["605","static/chunks/app/post/%5Bslug%5D/page-5fc1a46522590ee2.js"],"default"]
d:I[6798,["605","static/chunks/app/post/%5Bslug%5D/page-5fc1a46522590ee2.js"],"default"]
b:T2493,<p>본격적인 사용 방법을 알아보기에 앞서 Namespace, ResourceQuota, LimitRange 를 왜 사용해야 하는지 먼저 정리한다.</p>
<p><img src="/tech-blog/resources/images/kubernetes/0009-01.png" alt="0009-01"></p>
<p>k8s Cluster 라고 해서 전체 사용할 수 있는 자원이 있다. 일반적으로 Memory, CPU 가 있고 Cluster 안에는 다수의 Namespace 를 Namespace 안에는 다수의 Pod 를 만들 수
있다. 각 Pod 는 필요한 자원을 Cluster 자원을 공유하여 사용하는데, 만약 한 Namespace 안에 있는 Pod 가 Cluster 에 남은 자원을 모두 사용해버리면 다른 Pod 입장에서는 더 이상 사용할
수 있는 자원이 없어서 자원이 필요할 때 문제가 생기게 된다.</p>
<p>이런 문제를 해결하기 위해 ResourceQuota 가 존재하는데 이것은 Namespace 마다 최대 한계를 설정할 수 있다. Pod 가 사용할 수 있는 자원은 ResourceQuota 에 설정된 값을 넘을 수 없기
때문에 한 Pod 가 더 많은 자원을 사용하지 못해 문제가 될 수는 있지만 다른 Namespace 에 있는 Pod 에는 영향을 주지 않도록 한다.</p>
<p>그림의 가장 오른쪽에 있는 Namespace 와 같이 한 Pod 가 너무 많은 자원을 사용하면 다른 Pod 가 이 Namespace 에 더 이상 들어올 수 없게 된다. 그렇게 하지 못하도록 하기 위해
LimitRange 를 주어 Namespace 에 들어오는 Pod 의 크기를 제한할 수 있다. 한 Pod 의 자원 사용량이 LimitRange 에 설정 된 값보다 작아야 Namespace 에 들어올 수 있다.</p>
<p>추가로 ReourceQuota, LimitRange 는 Namespace 에만 적용할 수 있는 것은 아니고 Cluster 에 설정하여 전체 자원에 대한 제한을 할 수 있다.</p>
<h1>Namespace</h1>
<p><img src="/tech-blog/resources/images/kubernetes/0009-02.png" alt="0009-02"></p>
<p>한 Namespace 안에는 같은 타입의 오브젝트에 대해 같은 이름을 사용할 수 없다. 오브젝트마다 UUID 가 존재 하지만 한 Namespace 안에서는 같은 종류의 오브젝트라면 이름도 UUID 와 같이 유일한
key 역할을 할 수 있다.</p>
<p>Namespace 의 대표적인 특징으로 자신과 다른 Namespace 의 자원과 분리되어 관리 된다는 것인데, Pod 에 Label 을 붙이고 Service 에는 Selector 를 설정하여 연결하는데 서로 다른
Namespace 라면 연결되지 않는다. Node 나 PV 와 같이 모든 Namespace 에서 공유해서 사용할 수 있는 자원도 있지만 지금까지 살펴본 대부분의 자원은 Namespace 단위로 공유해서 사용 된다.</p>
<p>추가로 Namespace 안에 있는 자원을 삭제하게 되면 그 아에 있던 자원들도 모두 삭제되기 때문에 Namespace 를 삭제할 때는 유의해야 한다.</p>
<pre><code class="hljs language-yml"><span class="hljs-comment"># Namespace 생성 예시</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Namespace</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">nm-1</span>      <span class="hljs-comment"># 이름 외에 특별한 설정값 없음</span>
</code></pre>
<pre><code class="hljs language-yml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">pod-1</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">nm-1</span>       <span class="hljs-comment"># Pod 를 만들 때 속할 Namespace 를 지정</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">pod</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">containers:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">container</span>
      <span class="hljs-attr">image:</span> <span class="hljs-string">kubetm/app</span>
      <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span>
</code></pre>
<pre><code class="hljs language-yml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">svc-1</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">nm-1</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">pod</span>
  <span class="hljs-attr">ports:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span>
      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8080</span>
</code></pre>
<h1>ResourceQuota</h1>
<p><img src="/tech-blog/resources/images/kubernetes/0009-03.png" alt="0009-03"></p>
<p>ResourceQuota 는 namespace 의 자원 한계를 설정하는 오브젝트 이다. namespace 에 제한하고 싶은 자원을 명시할 수 있는데, (2-2) 를 보면 namespace 에 속할 Pod 들의 전체
request 자원과 memory 의 최대 값을 각각 1 기가로 하겠다는 설정 이다.</p>
<p>한 가지 기억할 것은 ResourceQuota 가 지정 된 namespace 에 Pod 를 만들 때 (2-4) 와 같이 무조건 동일한 스펙을 명시해야 한다. 만약 (2-3) 과 같이 스펙을 명시하지 않으면 이 Pod
는 (2-1) namespace 에 만들어지지 않는다.</p>
<p>또한 각 Pod 에 명시한 제한 값의 총 합이 namespace 에 설정한 최대 값보다 클 경우 나중에 만드는 Pod 는 생성되지 않는다.</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ResourceQuota</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">rq-1</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">nm-1</span>          <span class="hljs-comment"># 할당 할 namespace 설정</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">hard:</span> <span class="hljs-comment"># hard 라는 속성에</span>
    <span class="hljs-attr">requests.memory:</span> <span class="hljs-string">3Gi</span>   <span class="hljs-comment"># 제한 할 자원의 종류와 한계치를 설정</span>
    <span class="hljs-attr">limits.memory:</span> <span class="hljs-string">6Gi</span>
</code></pre>
<p>제한 가능한 자원 종류 : cpu, memory, storage
오브젝트 생성 개수 제한 : Pod, Service, ConfigMap, PVC ...</p>
<h1>LimitRange</h1>
<p><img src="/tech-blog/resources/images/kubernetes/0009-04.png" alt="0009-04"></p>
<p>LimitRange 의 기능은 각 Pod 마다 namespace 에 들어갈 수 있는지 자원 체크를 해준다.</p>
<p>체크하는 항목</p>
<ul>
<li>min
<ul>
<li>Pod 에서 설정 되는 memory 의 제한 값이 0.1 기가가 넘어야 한다.</li>
</ul>
</li>
<li>max
<ul>
<li>Pod 에서 설정되는 memory 의 제한 값이 0.4 기가를 넘을 수 없다.</li>
</ul>
</li>
<li>maxLimitRequestRatio
<ul>
<li>request 값과 limit 값의 비율이 최대 3 배를 넘을 수 없다.</li>
</ul>
</li>
</ul>
<p>(3-3) Pod 의 경우 설정 된 max memory 가 0.4 기가 인데 0.5 기가를 설정 하였으므로 namespace 에 속할 수 없다.</p>
<p>추가로 defaultRequest 와 default 속성이 있는데, (3-3') 와 같이 Pod 에 아무 설정을 하지 않았을 경우 자동으로 request 값과 limit 값이 할당 된다.</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">LimitRange</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">nm-1</span>               <span class="hljs-comment"># 할당 할 namespace 명시</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">limits:</span> <span class="hljs-comment"># limit 속성에</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">Container</span>        <span class="hljs-comment"># type 을 Container 별로 제한</span>
      <span class="hljs-attr">min:</span>
        <span class="hljs-attr">memory:</span> <span class="hljs-string">1Gi</span>
      <span class="hljs-attr">max:</span>
        <span class="hljs-attr">memory:</span> <span class="hljs-string">4Gi</span>
      <span class="hljs-attr">maxLimitRequestRatio:</span>
        <span class="hljs-attr">memory:</span> <span class="hljs-number">3</span>
      <span class="hljs-attr">defaultRequest:</span>
        <span class="hljs-attr">memory:</span> <span class="hljs-string">1Gi</span>
      <span class="hljs-attr">default:</span>
        <span class="hljs-attr">memory:</span> <span class="hljs-string">2Gi</span>
</code></pre>2:[["$","div",null,{"className":"$undefined","children":[["$","header",null,{"className":"PostHeader_postHeader__OohTH","children":[["$","h1",null,{"className":"PostHeader_title__NoKGt","children":"Namespace, ResourceQuota, LimitRange"}],["$","p",null,{"className":"PostHeader_description__moC_r","children":""}],["$","div",null,{"className":"PostHeader_meta__9Swgx","children":[["$","span",null,{"className":"$undefined","children":"nimkoes"}],["$","span",null,{"className":"$undefined","children":"2021-03-02"}]]}],["$","div",null,{"className":"PostHeader_tags__lGQ1Q","children":[["$","span","Kubernetes",{"className":"PostHeader_tag__Jf7BC","children":"Kubernetes"}],["$","span","k8s",{"className":"PostHeader_tag__Jf7BC","children":"k8s"}],["$","span","infra",{"className":"PostHeader_tag__Jf7BC","children":"infra"}]]}]]}],["$","$L8",null,{}],["$","article",null,{"className":"page_markdown__SVl4d","children":[["$","$L9",null,{"className":"page_topAd__ctbB7"}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":""}}],["$","$La",null,{"className":"page_middleAd__4qBOv","client":"ca-pub-6151583773425822","slot":"your-ad-slot-id"}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":"$b"}}],["$","$La",null,{"className":"page_bottomAd__f0OO_","client":"ca-pub-6151583773425822","slot":"your-ad-slot-id"}]]}]]}],["$","div",null,{"className":"page_floatingButtons__qJiZU","children":["$","$Lc",null,{}]}],["$","$Ld",null,{}]]
7:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Namespace, ResourceQuota, LimitRange | Nimkoes Tech Blog"}],["$","meta","3",{"name":"description","content":"기본 설명"}],["$","meta","4",{"name":"application-name","content":"Nimkoes Tech Blog"}],["$","link","5",{"rel":"author","href":"https://nimkoes.github.io/tech-blog"}],["$","meta","6",{"name":"author","content":"Nimkoes"}],["$","link","7",{"rel":"manifest","href":"/tech-blog/site.webmanifest","crossOrigin":"use-credentials"}],["$","meta","8",{"name":"keywords","content":"tech-blog,backend,software architect,infrastructure,development"}],["$","meta","9",{"name":"creator","content":"Nimkoes"}],["$","meta","10",{"name":"publisher","content":"Nimkoes"}],["$","meta","11",{"name":"robots","content":"index, follow, nocache"}],["$","meta","12",{"name":"googlebot","content":"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"}],["$","meta","13",{"name":"category","content":"technology"}],["$","link","14",{"rel":"canonical","href":"https://nimkoes.github.io/tech-blog"}],["$","link","15",{"rel":"alternate","hrefLang":"ko-KR","href":"https://nimkoes.github.io/tech-blog"}],["$","meta","16",{"name":"format-detection","content":"telephone=no, address=no, email=no"}],["$","meta","17",{"name":"google-adsense-account","content":"ca-pub-6151583773425822"}],["$","meta","18",{"property":"og:title","content":"Nimkoes Tech Blog - 개발자의 기술 이야기"}],["$","meta","19",{"property":"og:description","content":"I work diligently to become lazy ☕"}],["$","meta","20",{"property":"og:url","content":"https://nimkoes.github.io/tech-blog"}],["$","meta","21",{"property":"og:site_name","content":"Nimkoes Tech Blog"}],["$","meta","22",{"property":"og:locale","content":"ko_KR"}],["$","meta","23",{"property":"og:image","content":"https://nimkoes.github.io/tech-blog/og-image.png"}],["$","meta","24",{"property":"og:image:width","content":"1200"}],["$","meta","25",{"property":"og:image:height","content":"630"}],["$","meta","26",{"property":"og:image:alt","content":"Nimkoes Tech Blog"}],["$","meta","27",{"property":"og:image:type","content":"image/png"}],["$","meta","28",{"property":"og:type","content":"website"}],["$","meta","29",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","30",{"name":"twitter:site","content":"@nimkoes"}],["$","meta","31",{"name":"twitter:creator","content":"@nimkoes"}],["$","meta","32",{"name":"twitter:title","content":"Nimkoes Tech Blog"}],["$","meta","33",{"name":"twitter:description","content":"I work diligently to become lazy ☕"}],["$","meta","34",{"name":"twitter:image","content":"https://nimkoes.github.io/tech-blog/og-image.png"}],["$","link","35",{"rel":"icon","href":"/tech-blog/favicon.ico","sizes":"any"}],["$","link","36",{"rel":"icon","href":"/tech-blog/icon.svg","type":"image/svg+xml"}],["$","link","37",{"rel":"icon","href":"/tech-blog/favicon-32x32.png","sizes":"32x32","type":"image/png"}],["$","link","38",{"rel":"icon","href":"/tech-blog/favicon-16x16.png","sizes":"16x16","type":"image/png"}],["$","link","39",{"rel":"apple-touch-icon","href":"/tech-blog/apple-touch-icon.png","sizes":"180x180","type":"image/png"}],["$","link","40",{"rel":"mask-icon","href":"/tech-blog/safari-pinned-tab.svg","color":"#5bbad5"}],["$","meta","41",{"name":"next-size-adjust"}]]
1:null
